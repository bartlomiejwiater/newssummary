{% extends "index.html" %}

{% block form %}
{% load crispy_forms_tags %}
{% crispy form_element %}
{% endblock %}

{% block body %}
<table class="table table-striped table-hover ">
  <thead>
    <tr>
      <th></th>
      <th>#</th>
      <th>Name</th>
      <th>Weight</th>
      <th>Options</th>
    </tr>
  </thead>
  <tbody>
    {% for word in words %}
      <tr>
        <td><input type="checkbox"></td>
        <td>{{ forloop.counter }}</td>
        <td>{{ word.name }}</td>
        <td>{{ word.weight }}</td>
        <td><a href="#" class="btn btn-primary btn-xs">History</a></td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block endscript %}

    <script>
    function create_post() {
      console.log("create post is working!") // sanity check
      console.log($('#id_start_date').val())
      console.log($('#id_end_date').val())

      var column1RelArray = [];
      $('li.select2-selection__choice').each(function(i){
          column1RelArray.push($(this).attr('title'));
      });
      console.log(column1RelArray);

      var tmp_data = {}

      if ($('#id_end_date').val()){
          tmp_data['end_date']= $('#id_end_date').val();
      }

      if ($('#id_start_date').val()){
          tmp_data['start_date']= $('#id_start_date').val();
      }

      if (column1RelArray){
          tmp_data['words']= column1RelArray;
      }
      console.log('tmp_data')
      console.log(tmp_data)

      $.ajax({
        url: '{% url "words-list" %}',
        type: "GET",
        data: tmp_data,
        traditional: true,

        success : function(json) {
            console.log(json);
            console.log("success");
            // TODO: Write dom mainpulation
        },

        error : function(xhr,errmsg,err) {
          // TODO: Write error message
            $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
            console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
        }
      });
    };

    $('#id-get-words-list').on('submit', function(event){
      event.preventDefault();
      console.log("form submitted!")  // sanity check
      create_post();
    });

    </script>

{% endblock %}
